{"version":3,"file":"index-CK5oAj20.js","sources":["../../../../virtual:public?%2Fhero-shopping.svg","../../../../components/ProductCard.vue","../../../../pages/index.vue"],"sourcesContent":["import { publicAssetsURL } from '#internal/nuxt/paths';export default publicAssetsURL(\"/hero-shopping.svg\")","<template>\r\n  <div\r\n    class=\"border rounded-lg p-6 shadow-md hover:shadow-xl cursor-pointer transition-transform transform hover:scale-105 flex flex-col\"\r\n    @click=\"$emit('show-detail', product)\"\r\n  >\r\n    <!-- ‰∏äÂçäÈÉ®ÔºöÂúñÁâá + ÂêçÁ®± -->\r\n    <div>\r\n      <!-- ÂïÜÂìÅÂúñÁâá -->\r\n      <img\r\n        :src=\"product.image || '/default-product.png'\"\r\n        alt=\"ÂïÜÂìÅÂúñÁâá\"\r\n        class=\"w-full h-56 object-contain mb-4\"\r\n      />\r\n\r\n      <!-- ÂïÜÂìÅÂêçÁ®± -->\r\n      <h3 class=\"text-xl font-semibold\">\r\n        {{ product.name || product.name_zh }}\r\n      </h3>\r\n    </div>\r\n\r\n    <!-- ‰∏ãÂçäÈÉ®ÔºöÂàÜÈ°û + ÂÉπÊ†º + ÊåâÈàï -->\r\n    <div class=\"mt-auto\">\r\n      <!-- ÂïÜÂìÅÂàÜÈ°û -->\r\n      <p class=\"text-base text-gray-600 mb-2\">\r\n        {{ product.category }}\r\n      </p>\r\n\r\n      <!-- ÂïÜÂìÅÂÉπÊ†º -->\r\n      <p class=\"text-lg font-bold text-[#b9a2a6] mb-4\">\r\n        ${{ product.price ?? 'Êú™ÂÆöÂÉπ' }}\r\n      </p>\r\n\r\n      <!-- Âä†ÂÖ•Ë≥ºÁâ©Ëªä -->\r\n      <button\r\n        class=\"w-full bg-[#b9a2a6] text-white px-4 py-2 rounded hover:opacity-90\"\r\n        @click.stop=\"$emit('add-to-cart', product)\"\r\n      >\r\n        Âä†ÂÖ•Ë≥ºÁâ©Ëªä\r\n      </button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\ndefineProps({\r\n  product: { type: Object, required: true }\r\n})\r\n\r\ndefineEmits(['add-to-cart', 'show-detail'])\r\n</script>\r\n","<template>\r\n  <div class=\"min-h-screen bg-gray-50 text-stone-800\">\r\n    <!-- Header -->\r\n    <Header\r\n      v-model=\"searchQuery\"\r\n      :cart-count=\"cart.length\"\r\n      @toggle-cart=\"showCart = !showCart\"\r\n    />\r\n\r\n    <!-- Hero ÂçÄÂ°äÔºàÁæéÂåñÁâàÔºâ -->\r\n    <section class=\"relative bg-gradient-to-r from-[#b9a2a6] to-[#d7c5c8] text-white py-16 overflow-hidden\">\r\n      <div class=\"page-container grid md:grid-cols-2 gap-8 items-center\">\r\n        <!-- Â∑¶ÈÇäÔºöÊñáÂ≠ó -->\r\n        <div class=\"text-center md:text-left z-10\">\r\n          <h1 class=\"text-4xl md:text-5xl font-bold mb-4 drop-shadow-lg\">\r\n            ÊâæÂà∞‰Ω†ÁöÑÁêÜÊÉ≥ÂïÜÂìÅ üõçÔ∏è\r\n          </h1>\r\n          <p class=\"text-lg md:text-xl mb-6 opacity-90\">\r\n            Á≤æÈÅ∏ÁÜ±Èä∑Ê¨æÂºèÔºåÂÑ™ÊÉ†ÈôêÊôÇÈÄ≤Ë°å‰∏≠ÔºÅ\r\n          </p>\r\n          <!-- ÊêúÂ∞ãÊ°Ü -->\r\n          <div class=\"relative max-w-md mx-auto md:mx-0\">\r\n            <span class=\"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400\">\r\n              üîç\r\n            </span>\r\n            <input\r\n              v-model=\"searchQuery\"\r\n              type=\"text\"\r\n              placeholder=\"ÊêúÂ∞ã‰Ω†ÊÉ≥Ë¶ÅÁöÑÂïÜÂìÅ...\"\r\n              class=\"w-full pl-10 pr-4 py-3 rounded-full text-stone-700 shadow-lg focus:ring-2 focus:ring-[#b9a2a6] focus:outline-none\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Âè≥ÈÇäÔºöÊèíÂúñ -->\r\n        <div class=\"hidden md:flex justify-center items-center relative\">\r\n          <!-- ‚úÖ Ê≥®ÊÑèÔºöÈÄôË£°‰∏ÄÂÆöË¶ÅÁî® /hero-shopping.svg ÊâçÊúÉËÆÄ public Ë≥áÊñôÂ§æ -->\r\n          <img\r\n            src=\"/hero-shopping.svg\"\r\n            alt=\"Ë≥ºÁâ©ÊèíÁï´\"\r\n            class=\"w-4/5 drop-shadow-xl animate-fadeInUp\"\r\n            draggable=\"false\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <!-- ËÉåÊôØË£ùÈ£æÂúìÂúà -->\r\n      <div class=\"absolute -top-10 -right-20 w-72 h-72 bg-white/10 rounded-full blur-3xl\"></div>\r\n      <div class=\"absolute bottom-0 left-0 w-64 h-64 bg-white/10 rounded-full blur-2xl\"></div>\r\n    </section>\r\n\r\n\r\n    <!-- üî• Top 10 ÁÜ±ÈñÄÂïÜÂìÅ -->\r\n    <section class=\"page-container my-8\">\r\n      <h2 class=\"text-xl font-bold mb-4\">üî• ÁÜ±ÈñÄÂâç 10 Âêç</h2>\r\n      <div class=\"flex gap-4 overflow-x-auto pb-2\">\r\n        <div\r\n          v-for=\"p in topProducts\"\r\n          :key=\"p.id\"\r\n          class=\"min-w-[220px] max-w-[220px] flex-shrink-0 border rounded-lg p-4 shadow hover:shadow-lg cursor-pointer\"\r\n          @click=\"$router.push(`/product/${p.id}`)\"\r\n        >\r\n          <img\r\n            :src=\"p.image || '/default-product.png'\"\r\n            alt=\"ÂïÜÂìÅÂúñÁâá\"\r\n            class=\"w-full h-40 object-contain mb-2\"\r\n            @error=\"e => e.target.src = '/default-product.png'\"\r\n          />\r\n          <h3 class=\"text-sm font-semibold truncate\">{{ p.name || p.name_zh }}</h3>\r\n          <p class=\"text-xs text-gray-500\">{{ p.category || 'Êú™ÂàÜÈ°û' }}</p>\r\n          <p class=\"text-base font-bold text-[#b9a2a6]\">\r\n            NT$ {{ formatPrice(p.price) }}\r\n          </p>\r\n          <button\r\n            class=\"mt-2 w-full bg-[#b9a2a6] text-white text-sm px-2 py-1 rounded hover:opacity-90\"\r\n            @click.stop=\"addToCart(p)\"\r\n          >\r\n            Âä†ÂÖ•Ë≥ºÁâ©Ëªä\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n    <!-- ÁÜ±Ë≥£ÂïÜÂìÅ (ÁÑ°ÈôêÊªæÂãïÔºå‰∏ãÊñπÊ∏ÖÂñÆ) -->\r\n    <div class=\"page-container\">\r\n      <h2 class=\"text-xl font-bold mb-4\">üî• ÁÜ±Ë≥£ÂïÜÂìÅ</h2>\r\n\r\n      <main class=\"product-grid\">\r\n        <ProductCard\r\n          v-for=\"p in filteredProducts\"\r\n          :key=\"p.id\"\r\n          :product=\"p\"\r\n          @add-to-cart=\"addToCart\"\r\n          @show-detail=\"goDetail(p)\"\r\n        />\r\n      </main>\r\n\r\n      <!-- loading & Â∑≤Âà∞Â∫ï -->\r\n      <div v-if=\"pending\" class=\"text-center py-6 text-gray-500\">ËºâÂÖ•‰∏≠...</div>\r\n      <div v-if=\"done\" class=\"text-center py-6 text-gray-400\">Â∑≤Á∂ìÂà∞Â∫ï‰∫Ü</div>\r\n    </div>\r\n\r\n    <!-- Ë≥ºÁâ©Ëªä -->\r\n    <CartDrawer\r\n      :cart=\"cart\"\r\n      :total=\"total\"\r\n      :show=\"showCart\"\r\n      @increase=\"increaseQuantity\"\r\n      @decrease=\"decreaseQuantity\"\r\n      @checkout=\"checkout\"\r\n      @close=\"showCart = false\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted, onUnmounted, watch } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport { useCart } from '~/composables/useCart'\r\nimport Header from '~/components/Header.vue'\r\nimport ProductCard from '~/components/ProductCard.vue'\r\nimport CartDrawer from '~/components/CartDrawer.vue'\r\n\r\n// router\r\nconst router = useRouter()\r\nfunction goDetail(p) {\r\n  router.push(`/product/${p.id}`)\r\n}\r\n\r\n// Ë≥ºÁâ©Ëªä\r\nconst { cart, addToCart, increaseQuantity, decreaseQuantity, clearCart } = useCart()\r\n\r\n// UI ÁãÄÊÖã\r\nconst showCart = ref(false)\r\n\r\n// Êü•Ë©¢Ê¢ù‰ª∂\r\nconst searchQuery = ref('')\r\nconst selectedCategory = ref('ÂÖ®ÈÉ®')\r\n\r\n// ÂïÜÂìÅÂàÜÈ°û (Âæû API Êäì)\r\nconst categories = ref(['ÂÖ®ÈÉ®'])\r\nasync function loadCategories() {\r\n  try {\r\n    const res = await $fetch('/api/categories?page=1&limit=50')\r\n    if (res && res.length) {\r\n      categories.value = ['ÂÖ®ÈÉ®', ...res]\r\n    }\r\n  } catch (err) {\r\n    console.error('ËºâÂÖ•ÂàÜÈ°ûÂ§±Êïó:', err)\r\n  }\r\n}\r\n\r\n// ÂàÜÈ†Å & ÁÑ°ÈôêÊªæÂãïÁãÄÊÖã\r\nconst allProducts = ref([])\r\nconst page = ref(1)\r\nconst pageSize = 20\r\nconst totalPages = ref(1)\r\nconst pending = ref(false)\r\nconst done = ref(false)\r\n\r\n// Top 10\r\nconst topProducts = ref([])\r\n\r\n// API ËºâÂÖ•\r\nasync function loadProducts() {\r\n  if (pending.value || done.value) return\r\n  pending.value = true\r\n  try {\r\n    const res = await $fetch('/api/products', {\r\n      query: {\r\n        page: page.value,\r\n        pageSize,\r\n        q: searchQuery.value,\r\n        category: selectedCategory.value\r\n      }\r\n    })\r\n    if (res?.data?.length) {\r\n      allProducts.value.push(...res.data)\r\n      totalPages.value = res.pagination.totalPages\r\n      page.value += 1\r\n      if (page.value > totalPages.value) done.value = true\r\n    } else {\r\n      done.value = true\r\n    }\r\n  } catch (e) {\r\n    console.error('ËºâÂÖ•ÂïÜÂìÅÂ§±Êïó:', e)\r\n  } finally {\r\n    pending.value = false\r\n  }\r\n}\r\n\r\n// Top 10 ÁÜ±ÈñÄÂïÜÂìÅ\r\nasync function loadTop10() {\r\n  try {\r\n    const res = await $fetch('/api/products', {\r\n      query: { page: 1, pageSize: 10, q: searchQuery.value, category: selectedCategory.value }\r\n    })\r\n    topProducts.value = (res?.data || []).map(p => ({\r\n      ...p,\r\n      image: p.image || '/default-product.png'\r\n    }))\r\n  } catch (e) {\r\n    console.error('ËºâÂÖ• Top 10 Â§±Êïó:', e)\r\n  }\r\n}\r\n\r\n// ÈÅéÊøæÂæåÁöÑÂïÜÂìÅÔºàÊéíÈô§ Top 10Ôºâ\r\nconst filteredProducts = computed(() => {\r\n  const topIds = new Set(topProducts.value.map(p => p.id))\r\n  return allProducts.value\r\n    .filter(p => !topIds.has(p.id))\r\n    .map(p => ({\r\n      ...p,\r\n      image: p.image || '/default-product.png'\r\n    }))\r\n})\r\n\r\n// Êç≤Âà∞Â∫ïËá™ÂãïËºâÂÖ•\r\nfunction handleScroll() {\r\n  const nearBottom = window.innerHeight + window.scrollY >= document.body.offsetHeight - 100\r\n  if (nearBottom && !pending.value && !done.value) loadProducts()\r\n}\r\n\r\n// Ê¢ù‰ª∂ËÆäÊõ¥ÊôÇÈáçÁΩÆ\r\nfunction resetAndSearch() {\r\n  allProducts.value = []\r\n  page.value = 1\r\n  totalPages.value = 1\r\n  done.value = false\r\n  loadTop10()\r\n  loadProducts()\r\n}\r\n\r\n// ÊêúÂ∞ã debounce\r\nlet searchTimer\r\nwatch(searchQuery, () => {\r\n  clearTimeout(searchTimer)\r\n  searchTimer = setTimeout(() => resetAndSearch(), 350)\r\n})\r\n\r\n// ÂàÜÈ°ûËÆäÊõ¥ ‚Üí ÈáçÊü•\r\nwatch(selectedCategory, () => {\r\n  resetAndSearch()\r\n})\r\n\r\nonMounted(() => {\r\n  loadTop10()\r\n  loadProducts()\r\n  loadCategories()\r\n  window.addEventListener('scroll', handleScroll)\r\n})\r\nonUnmounted(() => {\r\n  window.removeEventListener('scroll', handleScroll)\r\n})\r\n\r\n// ÈáëÈ°ç\r\nconst total = computed(() =>\r\n  cart.value.reduce((sum, i) => sum + Number(i.price) * Number(i.quantity), 0)\r\n)\r\n\r\n// Ê†ºÂºèÂåñÈáëÈ°ç\r\nfunction formatPrice(value) {\r\n  return new Intl.NumberFormat('zh-TW', {\r\n    style: 'decimal',\r\n    maximumFractionDigits: 0\r\n  }).format(value || 0)\r\n}\r\n\r\n// ÁµêÂ∏≥\r\nasync function checkout() {\r\n  try {\r\n    const res = await $fetch('/api/checkout', { method: 'POST', body: cart.value })\r\n    useNuxtApp().$toast?.success?.(res.message || 'ÁµêÂ∏≥ÊàêÂäüÔºÅ')\r\n    clearCart()\r\n  } catch (err) {\r\n    console.error(err)\r\n    useNuxtApp().$toast?.error?.('ÁµêÂ∏≥Â§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶')\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.scrollbar-hide {\r\n  -ms-overflow-style: none;\r\n  scrollbar-width: none;\r\n}\r\n.scrollbar-hide::-webkit-scrollbar {\r\n  display: none;\r\n}\r\n</style>\r\n"],"names":["_ssrRenderAttrs","_mergeProps","_ssrInterpolate","_unref","_ssrRenderAttr","_ssrRenderList"],"mappings":"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"}