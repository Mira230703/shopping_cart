{"file":"_id_-B8_Dd7Mi.js","mappings":"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","names":["_ssrRenderAttrs","_mergeProps","_unref","_ssrInterpolate","_ssrRenderList"],"sources":["../../../../pages/product/[id].vue"],"sourcesContent":["<template>\r\n  <div class=\"min-h-screen bg-gray-50 text-stone-800\">\r\n    <!-- Header -->\r\n    <Header\r\n      v-model=\"searchQuery\"\r\n      :cart-count=\"cart.length\"\r\n      @toggle-cart=\"showCart = !showCart\"\r\n    />\r\n\r\n    <div class=\"page-container py-8\">\r\n      <div v-if=\"pending\" class=\"text-center text-gray-500\">載入中...</div>\r\n      <div v-else-if=\"!product\" class=\"text-center text-red-500\">找不到商品</div>\r\n      <div v-else class=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n        <!-- 圖片 -->\r\n        <div class=\"flex justify-center items-start\">\r\n          <img\r\n            :src=\"product.image || '/default-product.png'\"\r\n            alt=\"商品圖片\"\r\n            class=\"w-full max-w-md object-contain rounded-lg border shadow\"\r\n          />\r\n        </div>\r\n\r\n        <!-- 商品資訊 -->\r\n        <div class=\"flex flex-col\">\r\n          <h1 class=\"text-2xl font-bold mb-4\">{{ product.name || product.name_zh }}</h1>\r\n          <p class=\"text-gray-600 mb-2\">分類：{{ product.category || '未分類' }}</p>\r\n          <p class=\"text-gray-700 leading-relaxed mb-6\">\r\n            {{ product.description || '此商品暫無詳細介紹' }}\r\n          </p>\r\n          <p class=\"text-xl font-bold text-[#b9a2a6] mb-6\">\r\n            NT$ {{ formatPrice(product.price) }}\r\n          </p>\r\n\r\n          <!-- 加入購物車 -->\r\n          <button\r\n            class=\"bg-[#b9a2a6] text-white px-6 py-3 rounded hover:opacity-90 w-full md:w-auto\"\r\n            @click=\"addToCart(product)\"\r\n          >\r\n            加入購物車\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 推薦商品 -->\r\n    <section class=\"page-container my-12\" v-if=\"recommended.length\">\r\n      <h2 class=\"text-xl font-bold mb-4\">✨ 推薦商品</h2>\r\n      <div class=\"flex gap-4 overflow-x-auto pb-2\">\r\n        <div\r\n          v-for=\"p in recommended\"\r\n          :key=\"p.id\"\r\n          class=\"min-w-[220px] max-w-[220px] flex-shrink-0 border rounded-lg p-4 shadow hover:shadow-lg cursor-pointer\"\r\n          @click=\"$router.push(`/product/${p.id}`)\"\r\n        >\r\n          <img\r\n            :src=\"p.image || '/default-product.png'\"\r\n            alt=\"商品圖片\"\r\n            class=\"w-full h-40 object-contain mb-2\"\r\n          />\r\n          <h3 class=\"text-sm font-semibold truncate\">{{ p.name || p.name_zh }}</h3>\r\n          <p class=\"text-xs text-gray-500\">{{ p.category || '未分類' }}</p>\r\n          <p class=\"text-base font-bold text-[#b9a2a6]\">\r\n            NT$ {{ formatPrice(p.price) }}\r\n          </p>\r\n          <button\r\n            class=\"mt-2 w-full bg-[#b9a2a6] text-white text-sm px-2 py-1 rounded hover:opacity-90\"\r\n            @click.stop=\"addToCart(p)\"\r\n          >\r\n            加入購物車\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n    <!-- 購物車 -->\r\n    <CartDrawer\r\n      :cart=\"cart\"\r\n      :total=\"total\"\r\n      :show=\"showCart\"\r\n      @increase=\"increaseQuantity\"\r\n      @decrease=\"decreaseQuantity\"\r\n      @checkout=\"checkout\"\r\n      @close=\"showCart = false\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted, watch } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport { useCart } from '~/composables/useCart'\r\nimport Header from '~/components/Header.vue'\r\nimport CartDrawer from '~/components/CartDrawer.vue'\r\n\r\nconst route = useRoute()\r\nconst { cart, addToCart, increaseQuantity, decreaseQuantity, clearCart } = useCart()\r\n\r\nconst showCart = ref(false)\r\nconst searchQuery = ref('')\r\nconst product = ref(null)\r\nconst pending = ref(true)\r\n\r\n// ⭐ 推薦商品列表\r\nconst recommended = ref([])\r\n\r\nasync function fetchProduct() {\r\n  try {\r\n    const res = await $fetch(`/api/product/${route.params.id}`)\r\n    product.value = res\r\n  } catch (e) {\r\n    console.error('取得商品失敗:', e)\r\n    product.value = null\r\n  } finally {\r\n    pending.value = false\r\n  }\r\n}\r\n\r\n// ⭐ 撈推薦結果（快速修正版：固定傳英文名稱）\r\nasync function loadRecommended() {\r\n  try {\r\n    if (!product.value?.name_zh) return\r\n    const res = await $fetch('/api/recommendations', {\r\n      query: { item: product.value.name_zh } // ← 一律傳英文名稱\r\n    })\r\n    recommended.value = res?.recommendations || []\r\n  } catch (e) {\r\n    if (e?.statusCode === 404) {\r\n      console.warn('沒有找到推薦商品')\r\n      recommended.value = []\r\n    } else {\r\n      console.error('載入推薦商品失敗:', e)\r\n      recommended.value = []\r\n    }\r\n  }\r\n}\r\n\r\n// 初始化載入\r\nonMounted(async () => {\r\n  await fetchProduct()\r\n  await loadRecommended()\r\n})\r\n\r\n// 切換路由參數（例如點推薦卡片進入另一個商品）時，重新撈資料\r\nwatch(() => route.params.id, async () => {\r\n  pending.value = true\r\n  product.value = null\r\n  recommended.value = []\r\n  await fetchProduct()\r\n  await loadRecommended()\r\n})\r\n\r\nconst total = computed(() =>\r\n  cart.value.reduce((sum, i) => sum + Number(i.price) * Number(i.quantity), 0)\r\n)\r\n\r\nasync function checkout() {\r\n  try {\r\n    const res = await $fetch('/api/checkout', { method: 'POST', body: cart.value })\r\n    useNuxtApp().$toast?.success?.(res.message || '結帳成功！')\r\n    clearCart()\r\n  } catch (err) {\r\n    console.error(err)\r\n    useNuxtApp().$toast?.error?.('結帳失敗，請稍後再試')\r\n  }\r\n}\r\n\r\nfunction formatPrice(value) {\r\n  return new Intl.NumberFormat('zh-TW', {\r\n    style: 'decimal',\r\n    maximumFractionDigits: 0\r\n  }).format(value || 0)\r\n}\r\n</script>\r\n\r\n\r\n"],"version":3}