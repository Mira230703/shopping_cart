import{J as H,x as i,y as n,z as o,A as p,K as I,_ as J,r as s,k as N,L as D,o as K,M as W,B as z,N as m,O as Y,P as G,Q as B,R as V,S as q,T as X,U as Z,a as A}from"./D0amlHy_.js";import{_ as tt,a as et,u as ot}from"./DclPNNHB.js";const at=H("/hero-shopping.svg"),st=["src"],lt={class:"text-xl font-semibold"},nt={class:"mt-auto"},rt={class:"text-base text-gray-600 mb-2"},it={class:"text-lg font-bold text-[#b9a2a6] mb-4"},ct={__name:"ProductCard",props:{product:{type:Object,required:!0}},emits:["add-to-cart","show-detail"],setup(l){return(g,c)=>(n(),i("div",{class:"border rounded-lg p-6 shadow-md hover:shadow-xl cursor-pointer transition-transform transform hover:scale-105 flex flex-col",onClick:c[1]||(c[1]=d=>g.$emit("show-detail",l.product))},[o("div",null,[o("img",{src:l.product.image||"/default-product.png",alt:"商品圖片",class:"w-full h-56 object-contain mb-4"},null,8,st),o("h3",lt,p(l.product.name||l.product.name_zh),1)]),o("div",nt,[o("p",rt,p(l.product.category),1),o("p",it," $"+p(l.product.price??"未定價"),1),o("button",{class:"w-full bg-[#b9a2a6] text-white px-4 py-2 rounded hover:opacity-90",onClick:c[0]||(c[0]=I(d=>g.$emit("add-to-cart",l.product),["stop"]))}," 加入購物車 ")])]))}},dt={class:"min-h-screen bg-gray-50 text-stone-800"},ut={class:"relative bg-gradient-to-r from-[#b9a2a6] to-[#d7c5c8] text-white py-16 overflow-hidden"},mt={class:"page-container grid md:grid-cols-2 gap-8 items-center"},pt={class:"text-center md:text-left z-10"},ft={class:"relative max-w-md mx-auto md:mx-0"},gt={class:"page-container my-8"},vt={class:"flex gap-4 overflow-x-auto pb-2"},ht=["onClick"],xt=["src"],bt={class:"text-sm font-semibold truncate"},wt={class:"text-xs text-gray-500"},yt={class:"text-base font-bold text-[#b9a2a6]"},$t=["onClick"],_t={class:"page-container"},Ct={class:"product-grid"},kt={key:0,class:"text-center py-6 text-gray-500"},Tt={key:1,class:"text-center py-6 text-gray-400"},Pt=20,St={__name:"index",setup(l){const g=X();function c(e){g.push(`/product/${e.id}`)}const{cart:d,addToCart:C,increaseQuantity:U,decreaseQuantity:L,clearCart:j}=ot(),v=s(!1),r=s(""),b=s("全部"),E=s(["全部"]);async function M(){try{const e=await $fetch("/api/categories?page=1&limit=50");e&&e.length&&(E.value=["全部",...e])}catch(e){console.error("載入分類失敗:",e)}}const w=s([]),h=s(1),y=s(1),f=s(!1),u=s(!1),$=s([]);async function _(){if(!(f.value||u.value)){f.value=!0;try{const e=await $fetch("/api/products",{query:{page:h.value,pageSize:Pt,q:r.value,category:b.value}});e?.data?.length?(w.value.push(...e.data),y.value=e.pagination.totalPages,h.value+=1,h.value>y.value&&(u.value=!0)):u.value=!0}catch(e){console.error("載入商品失敗:",e)}finally{f.value=!1}}}async function k(){try{const e=await $fetch("/api/products",{query:{page:1,pageSize:10,q:r.value,category:b.value}});$.value=(e?.data||[]).map(t=>({...t,image:t.image||"/default-product.png"}))}catch(e){console.error("載入 Top 10 失敗:",e)}}const Q=N(()=>{const e=new Set($.value.map(t=>t.id));return w.value.filter(t=>!e.has(t.id)).map(t=>({...t,image:t.image||"/default-product.png"}))});function T(){window.innerHeight+window.scrollY>=document.body.offsetHeight-100&&!f.value&&!u.value&&_()}function P(){w.value=[],h.value=1,y.value=1,u.value=!1,k(),_()}let S;D(r,()=>{clearTimeout(S),S=setTimeout(()=>P(),350)}),D(b,()=>{P()}),K(()=>{k(),_(),M(),window.addEventListener("scroll",T)}),W(()=>{window.removeEventListener("scroll",T)});const F=N(()=>d.value.reduce((e,t)=>e+Number(t.price)*Number(t.quantity),0));function O(e){return new Intl.NumberFormat("zh-TW",{style:"decimal",maximumFractionDigits:0}).format(e||0)}async function R(){try{const e=await $fetch("/api/checkout",{method:"POST",body:d.value});A().$toast?.success?.(e.message||"結帳成功！"),j()}catch(e){console.error(e),A().$toast?.error?.("結帳失敗，請稍後再試")}}return(e,t)=>(n(),i("div",dt,[z(tt,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),"cart-count":m(d).length,onToggleCart:t[1]||(t[1]=a=>v.value=!v.value)},null,8,["modelValue","cart-count"]),o("section",ut,[o("div",mt,[o("div",pt,[t[6]||(t[6]=o("h1",{class:"text-4xl md:text-5xl font-bold mb-4 drop-shadow-lg"}," 找到你的理想商品 🛍️ ",-1)),t[7]||(t[7]=o("p",{class:"text-lg md:text-xl mb-6 opacity-90"}," 精選熱銷款式，優惠限時進行中！ ",-1)),o("div",ft,[t[5]||(t[5]=o("span",{class:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"}," 🔍 ",-1)),Y(o("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>r.value=a),type:"text",placeholder:"搜尋你想要的商品...",class:"w-full pl-10 pr-4 py-3 rounded-full text-stone-700 shadow-lg focus:ring-2 focus:ring-[#b9a2a6] focus:outline-none"},null,512),[[G,r.value]])])]),t[8]||(t[8]=o("div",{class:"hidden md:flex justify-center items-center relative"},[o("img",{src:at,alt:"購物插畫",class:"w-4/5 drop-shadow-xl animate-fadeInUp",draggable:"false"})],-1))]),t[9]||(t[9]=o("div",{class:"absolute -top-10 -right-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"},null,-1)),t[10]||(t[10]=o("div",{class:"absolute bottom-0 left-0 w-64 h-64 bg-white/10 rounded-full blur-2xl"},null,-1))]),o("section",gt,[t[11]||(t[11]=o("h2",{class:"text-xl font-bold mb-4"},"🔥 熱門前 10 名",-1)),o("div",vt,[(n(!0),i(B,null,V($.value,a=>(n(),i("div",{key:a.id,class:"min-w-[220px] max-w-[220px] flex-shrink-0 border rounded-lg p-4 shadow hover:shadow-lg cursor-pointer",onClick:x=>e.$router.push(`/product/${a.id}`)},[o("img",{src:a.image||"/default-product.png",alt:"商品圖片",class:"w-full h-40 object-contain mb-2",onError:t[3]||(t[3]=x=>x.target.src="/default-product.png")},null,40,xt),o("h3",bt,p(a.name||a.name_zh),1),o("p",wt,p(a.category||"未分類"),1),o("p",yt," NT$ "+p(O(a.price)),1),o("button",{class:"mt-2 w-full bg-[#b9a2a6] text-white text-sm px-2 py-1 rounded hover:opacity-90",onClick:I(x=>m(C)(a),["stop"])}," 加入購物車 ",8,$t)],8,ht))),128))])]),o("div",_t,[t[12]||(t[12]=o("h2",{class:"text-xl font-bold mb-4"},"🔥 熱賣商品",-1)),o("main",Ct,[(n(!0),i(B,null,V(Q.value,a=>(n(),Z(ct,{key:a.id,product:a,onAddToCart:m(C),onShowDetail:x=>c(a)},null,8,["product","onAddToCart","onShowDetail"]))),128))]),f.value?(n(),i("div",kt,"載入中...")):q("",!0),u.value?(n(),i("div",Tt,"已經到底了")):q("",!0)]),z(et,{cart:m(d),total:F.value,show:v.value,onIncrease:m(U),onDecrease:m(L),onCheckout:R,onClose:t[4]||(t[4]=a=>v.value=!1)},null,8,["cart","total","show","onIncrease","onDecrease"])]))}},zt=J(St,[["__scopeId","data-v-e145bf50"]]);export{zt as default};
