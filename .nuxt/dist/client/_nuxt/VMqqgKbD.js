import{r as u,o as z,L as T,k as B,x as n,B as g,z as t,S as D,N as i,A as l,Q,R as j,V as F,y as r,K as I,a as b}from"./D0amlHy_.js";import{_ as P,a as R,u as S}from"./DclPNNHB.js";const q={class:"min-h-screen bg-gray-50 text-stone-800"},A={class:"page-container py-8"},L={key:0,class:"text-center text-gray-500"},M={key:1,class:"text-center text-red-500"},E={key:2,class:"grid grid-cols-1 md:grid-cols-2 gap-8"},K={class:"flex justify-center items-start"},O=["src"],U={class:"flex flex-col"},W={class:"text-2xl font-bold mb-4"},G={class:"text-gray-600 mb-2"},H={class:"text-gray-700 leading-relaxed mb-6"},J={class:"text-xl font-bold text-[#b9a2a6] mb-6"},X={key:0,class:"page-container my-12"},Y={class:"flex gap-4 overflow-x-auto pb-2"},Z=["onClick"],ee=["src"],te={class:"text-sm font-semibold truncate"},ae={class:"text-xs text-gray-500"},se={class:"text-base font-bold text-[#b9a2a6]"},oe=["onClick"],ce={__name:"[id]",setup(ne){const v=F(),{cart:d,addToCart:_,increaseQuantity:w,decreaseQuantity:k,clearCart:$}=S(),m=u(!1),p=u(""),a=u(null),h=u(!0),c=u([]);async function f(){try{const e=await $fetch(`/api/product/${v.params.id}`);a.value=e}catch(e){console.error("取得商品失敗:",e),a.value=null}finally{h.value=!1}}async function x(){try{if(!a.value?.name_zh)return;const e=await $fetch("/api/recommendations",{query:{item:a.value.name_zh}});c.value=e?.recommendations||[]}catch(e){e?.statusCode===404?(console.warn("沒有找到推薦商品"),c.value=[]):(console.error("載入推薦商品失敗:",e),c.value=[])}}z(async()=>{await f(),await x()}),T(()=>v.params.id,async()=>{h.value=!0,a.value=null,c.value=[],await f(),await x()});const C=B(()=>d.value.reduce((e,s)=>e+Number(s.price)*Number(s.quantity),0));async function N(){try{const e=await $fetch("/api/checkout",{method:"POST",body:d.value});b().$toast?.success?.(e.message||"結帳成功！"),$()}catch(e){console.error(e),b().$toast?.error?.("結帳失敗，請稍後再試")}}function y(e){return new Intl.NumberFormat("zh-TW",{style:"decimal",maximumFractionDigits:0}).format(e||0)}return(e,s)=>(r(),n("div",q,[g(P,{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=o=>p.value=o),"cart-count":i(d).length,onToggleCart:s[1]||(s[1]=o=>m.value=!m.value)},null,8,["modelValue","cart-count"]),t("div",A,[h.value?(r(),n("div",L,"載入中...")):a.value?(r(),n("div",E,[t("div",K,[t("img",{src:a.value.image||"/default-product.png",alt:"商品圖片",class:"w-full max-w-md object-contain rounded-lg border shadow"},null,8,O)]),t("div",U,[t("h1",W,l(a.value.name||a.value.name_zh),1),t("p",G,"分類："+l(a.value.category||"未分類"),1),t("p",H,l(a.value.description||"此商品暫無詳細介紹"),1),t("p",J," NT$ "+l(y(a.value.price)),1),t("button",{class:"bg-[#b9a2a6] text-white px-6 py-3 rounded hover:opacity-90 w-full md:w-auto",onClick:s[2]||(s[2]=o=>i(_)(a.value))}," 加入購物車 ")])])):(r(),n("div",M,"找不到商品"))]),c.value.length?(r(),n("section",X,[s[4]||(s[4]=t("h2",{class:"text-xl font-bold mb-4"},"✨ 推薦商品",-1)),t("div",Y,[(r(!0),n(Q,null,j(c.value,o=>(r(),n("div",{key:o.id,class:"min-w-[220px] max-w-[220px] flex-shrink-0 border rounded-lg p-4 shadow hover:shadow-lg cursor-pointer",onClick:V=>e.$router.push(`/product/${o.id}`)},[t("img",{src:o.image||"/default-product.png",alt:"商品圖片",class:"w-full h-40 object-contain mb-2"},null,8,ee),t("h3",te,l(o.name||o.name_zh),1),t("p",ae,l(o.category||"未分類"),1),t("p",se," NT$ "+l(y(o.price)),1),t("button",{class:"mt-2 w-full bg-[#b9a2a6] text-white text-sm px-2 py-1 rounded hover:opacity-90",onClick:I(V=>i(_)(o),["stop"])}," 加入購物車 ",8,oe)],8,Z))),128))])])):D("",!0),g(R,{cart:i(d),total:C.value,show:m.value,onIncrease:i(w),onDecrease:i(k),onCheckout:N,onClose:s[3]||(s[3]=o=>m.value=!1)},null,8,["cart","total","show","onIncrease","onDecrease"])]))}};export{ce as default};
